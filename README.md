# Strategic Analyst AI

Веб-приложение для **стратегических сессий**: участники по QR-коду заходят с телефонов или ноутбуков и в live-режиме оценивают предложения с помощью нейросети («Будет ли это работать?», «Продвигать / доработать / отклонить» и т.д.). Ответы нейросети — короткие (несколько строчек), чтобы их было удобно читать и оперативно собирать в онлайне.

## Зачем этот сайт

- **Стратегическая сессия**: собираются предложения, нужно быстро оценить каждое (работает ли идея, риски, вердикт).
- **Промты для нейросетей**: подготовлены так, чтобы ответ был **кратким** (несколько строчек), а не длинным отчётом.
- **Сбор и вывод в онлайне**: интерфейс рассчитан на то, чтобы участники оперативно получали оценки и могли ими пользоваться во время сессии (в перспективе — общий live-вывод результатов).
- **QR и любые устройства**: участникам выдаётся ссылка (QR) на сайт; удобно и с телефона, и с ноутбука.

## Возможности

- **Консультант** — диалог с AI-аналитиком. Можно прикрепить файл (TXT, CSV, XLSX, DOCX) как контекст. Выгрузка диалога: TXT, Markdown, Word (DOCX).
- **SWOT-Анализ** — ввод тезисов текстом или файлом (.txt, .csv, .xlsx). Запуск анализа, таблица с вердиктами (Продвигать / Доработать / Отклонить), фильтр по вердикту. Выгрузка: Excel (XLSX) со сводкой, Word (DOCX), CSV, Markdown.

Режимы поддерживают **короткие ответы** (настраиваемые промты и лимит длины), чтобы на стратегической сессии было удобно читать с экрана и собирать выводы.


## Структура проекта

- `app.py` — точка входа, сборка страницы и табов.
- `core/` — конфигурация (`config.py`), инициализация состояния (`state.py`).
- `ui/` — стили, шапка, боковая панель, табы «Консультант» и «SWOT-Анализ».
- `services/` — парсинг файлов и тезисов, построение HTML-таблицы результатов.
- `modules/` — OpenRouter API, промты, экспорт в XLSX/CSV/MD/DOCX.
- `.streamlit/` — настройки Streamlit и кастомный CSS (в т.ч. мобильная вёрстка).

## Поддержка

- Проверьте корректность API-ключа и доступность OpenRouter.
- Рекомендуемый размер загружаемых файлов — до 5 MB.

# Архитектура приложения Strategic Analyst AI

## Структура проекта

```
strategicanalystai/
├── app.py                    # Точка входа: конфиг страницы, инициализация, сборка UI
├── core/                     # Конфигурация и состояние
│   ├── config.py             # Константы: модели, лимиты, типы файлов
│   └── state.py              # Инициализация session_state
├── ui/                       # Компоненты интерфейса
│   ├── styles.py             # Подключение кастомного CSS
│   ├── header.py             # Верхняя панель (логотип, статус API)
│   ├── sidebar.py            # Боковая панель: API, модель, подсказки
│   ├── consultant_tab.py     # Режим «Консультант»: чат, файл, экспорт
│   └── swot_tab.py           # Режим «SWOT-Анализ»: ввод, анализ, таблица, экспорт
├── services/                 # Бизнес-логика, не зависящая от Streamlit
│   ├── file_parser.py        # Парсинг тезисов и чтение файлов в текст
│   └── swot_ui.py            # Вердикты, HTML-таблица результатов
├── modules/                  # Интеграции и экспорт
│   ├── api_handler.py        # Запросы к OpenRouter API
│   ├── prompts.py            # Системные промты для консультанта и SWOT
│   └── export_utils.py       # Экспорт в XLSX, CSV, MD, DOCX (чат и SWOT)
├── .streamlit/
│   ├── config.toml           # Тема и настройки Streamlit
│   └── styles.css            # Стили: кнопки, таблицы, бейджи, скроллбар
├── docs/
│   ├── ARCHITECTURE.md       # Этот файл
│   └── STRATEGIC_SESSION.md  # Сценарий сессии, live-сбор ответов, мобильная версия
├── requirements.txt
└── README.md
```

## Поток данных

1. **Запуск**  
   `app.py` задаёт `st.set_page_config`, вызывает `init_session_state()`, подключает CSS и рендерит header и sidebar. Sidebar возвращает `(api_key, model)` для использования в табах.

2. **Консультант**  
   Пользователь вводит сообщение (и опционально прикрепляет файл). Контекст файла читается через `services.file_parser.read_uploaded_file_as_text`. Сообщения хранятся в `st.session_state.chat_messages`. Ответ получается через `modules.api_handler.chat_completion_with_history`. Экспорт диалога — через `modules.export_utils` (TXT, MD, DOCX).

3. **SWOT-Анализ**  
   Тезисы вводятся текстом или загружаются файлом; парсинг — `services.file_parser.parse_theses_from_text` / `parse_theses_from_upload`. Для каждого тезиса вызывается `modules.api_handler.chat_completion`; ответ разбирается в `modules.export_utils.parse_swot_response`. Результаты в `st.session_state.swot_results`. Таблица строится в `services.swot_ui.build_results_table_html`. Экспорт — XLSX (с листом «Сводка»), DOCX, CSV, MD.

## Зависимости между слоями

- **app.py** зависит от: `core`, `ui`.
- **ui/** зависит от: `core`, `modules`, `services`.
- **services/** не зависит от `ui` и `app`; при необходимости использует только стандартные библиотеки и pandas.
- **modules/** — интеграции (API, промты, экспорт); не зависят от `ui` и `services`.

## Стили и кнопки

- Все тексты кнопок — только текст (без эмодзи/иконок в подписи), чтобы избежать отображения «keyboard_double_arrow» или других глифов при отсутствии шрифта.
- Цвета и типографика заданы в `.streamlit/styles.css` и `config.toml` (primary, фон, шрифт).

## Стратегическая сессия и устройства

- **Цель**: участникам выдаётся QR на сайт; они используют телефоны/ноутбуки во время сессии в live-режиме.
- **Промты**: настроены так, чтобы ответы были короткими (несколько строчек), а не длинными отчётами.
- **Мобильная версия**: в `.streamlit/styles.css` заданы `@media (max-width: 768px)` — компактные отступы, читаемый текст, удобные кнопки и поле ввода.
- **Live-сбор ответов**: текущая версия — каждый участник работает в своей сессии; экспорт (TXT, MD, XLSX, DOCX) позволяет собрать результаты. Варианты развития — в `docs/STRATEGIC_SESSION.md`.

# Стратегическая сессия: сценарий и live-сбор ответов

## Зачем сайт

Сайт предназначен для **стратегических сессий**, где нужно:

1. **Подготовить промты для нейросетей** — оценивать выбранные предложения («Будет ли это работать?», «Продвигать / доработать / отклонить» и т.д.). Ответ нейросети должен быть **коротким** (несколько строчек), а не длинным отчётом.
2. **Оперативно собирать ответы** и выводить их в **онлайн-формате** — участники видят оценки в live-режиме.
3. **Удобно использовать с телефона и с компьютера** — участникам выдаётся QR на сайт, они заходят с телефонов или ноутбуков во время сессии.

## Текущий сценарий использования

- Организатор разворачивает приложение (локально или в облаке, например Streamlit Cloud).
- Участникам выдаётся **ссылка или QR-код** на URL приложения.
- Каждый участник открывает сайт на своём устройстве (телефон или ноутбук) и:
  - в режиме **Консультант** — задаёт вопросы по ситуациям/предложениям и получает короткие оценки;
  - в режиме **SWOT-Анализ** — загружает или вводит тезисы и получает таблицу с вердиктами (Продвигать / Доработать / Отклонить).
- Результаты можно **экспортировать** (TXT, MD, XLSX, DOCX) и при необходимости объединять вручную или показывать на общем экране.

## Короткие ответы нейросети

- В **Консультант** в боковой панели есть переключатель **«Ответ консультанта»**: «Развёрнутый» или **«Короткий (для сессии)»**. В коротком режиме ответ ограничен несколькими строчками (2–5 строк), удобно для оценки «будет ли это работать» на стратегической сессии.
- В **SWOT-Анализ** в настройках блока анализа можно выбрать шаблон: «Строгий (минимум текста)», «Стандартный (краткий)», «Детальный» — для сессии удобнее «Строгий» или «Стандартный».
- В `core/config.py`: `CHAT_MAX_TOKENS` — для развёрнутого ответа, `CHAT_MAX_TOKENS_SHORT` (512) — для короткого режима консультанта.

## Удобство с телефона и компьютера

- Интерфейс адаптирован под **мобильные и десктоп**:
  - в `.streamlit/styles.css` заданы стили для `@media (max-width: 768px)`: уменьшенные отступы, читаемые шрифты, компактные кнопки и поле ввода;
  - блок чата, таблица SWOT и кнопки экспорта остаются удобными на узком экране;
  - вкладки и боковая панель не «ломаются» на телефоне.
- Рекомендуется перед сессией проверить работу по QR с телефона (тот же Wi‑Fi или мобильный интернет).